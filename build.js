!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(n["vue-validity"]=n["vue-validity"]||{})}(this,function(n){"use strict";function t(n,t){const e=".";t=t.replace(/\[(\w+)\]/g,".$1"),t="."+t;const i=new RegExp("^\\.");t=t.replace(i,"");const r=t.split(e);for(var s=0;s<r.length;++s){let t=r[s];if(!(t in n))return;n=n[t]}return n}function e(n,t){return n.classList?n.classList.contains(t):!!n.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function i(n,t){n.classList?n.classList.add(t):e(n,t)||(n.className+="  "+t)}function r(n,t){if(n.classList)n.classList.remove(t);else if(e(n,t)){const e=new RegExp("(\\s|^)"+t+"(\\s|$)");n.className=n.className.replace(e," ")}}function s(n){return o(n)&&"function"==typeof n.message&&"function"==typeof n.validate}function o(n){return null!==n&&"object"==typeof n}function c(n){return o(n)&&("undefined"==typeof n.$message||"undefined"==typeof n.$value)}function u(n,t){t=Object.assign({},O,t),i(n,t.dirty),r(n,t.pristine)}function a(n,t){t=Object.assign({},O,t),i(n,t.pristine),r(n,t.dirty)}function f(n,e){if(e.context.$v){if(e.context.$vChild)return e.context.$v;let i=n.value;if(!i){const n=e.data.directives.filter(n=>{return"model"===n.name});if(n.length)i=n[0].expression;else{const n=e.context.$options._parentVnode.data||[],t=n.directives.filter(n=>"model"===n.name);n.directives.length||(i=""),i=t[0].expression}}return i?t(e.context.$v,i):e.context.$v}}function l(n,t,e,s=null){s=Object.assign(O,s);const o=f(t,e);if(o){const t=o.$dirty,e=o.$valid;t?(i(n,s.touched),r(n,s.untouched)):(i(n,s.untouched),r(n,s.touched)),e?(i(n,s.valid),r(n,s.invalid)):(i(n,s.invalid),r(n,s.valid))}}function d(n,t){return n[t]}function h(n){if(L)return L;let t=n.constructor;for(;t.super;)t=t.super;return L=t,t}function v(n){this.dirty=n;const t=n?"$validate":"$reset",e=this.dynamicKeys;for(var i=0;i<e.length;i++){const n=e[i],r=this[n];c(r)&&r[t]()}}function p(n){this.setErrors=[];for(let t=0;t<n.length;t++){const e=n[t];this.name===e.field&&(this.dirty=!0,this.setErrors.push(e))}const e=this.dynamicKeys;for(var i=0;i<e.length;i++){const t=e[i],r=this[t];c(r)&&r.$setErrors(n)}}function y(n,t,e=t,i=null){const r=Object.keys(n).filter(t=>!!n[t]),s=r.map(q),o=E(r,r=>{const s=n[r];return g(e,s,r,t,i)},q),c=h(e),u=new c({data:{dirty:!1,dynamicKeys:s,name:i,setErrors:[]},methods:M,computed:Object.assign({},o,N)});return m(u,r)}function g(n,t,e,i,r){return s(t)?$(n,t,e,i,r):b(n,t,e,i,r)}function m(n,t){const e=Object.assign({__isValidity:{configurable:!1,enumerable:!1,value:!0}},E(t,t=>{let e=q(t);return{enumerable:!0,get(){return d(n,e)}}}),E(k,t=>({enumerable:!0,get(){return n[t]}})),E(R,t=>({value:n[t].bind(n)})));return Object.defineProperties({},e)}function $(n,t,e,i,r){return function(){let e={};t.options&&(e=t.options.reduce((n,t)=>{return n[t.name]=t.value,n},{}));const s=t.validate.call(n,i[r],e);if(o(s)&&s.__isValidity)return s;const c=t.message.call(n,r,t.options);return{$value:!!s,$message:c}}}function b(n,t,e,i,r){if(Array.isArray(t)){const n={};for(var s=0;s<t.length;s++){let e=t[s],i=[];const r=e.indexOf(":"),o=r!==-1;o&&(i=e.substr(r+1).split(","),e=e.substr(0,r));const c=K[e];for(let u=0;u<i.length;u++){const n=i[u],t=c.options[u];t.value=n}n[e]=c}t=n}const o="string"==typeof r?i[r]:i,c=y(t,o,n,e);return x(c)}const x=n=>()=>n,E=(n,t,e)=>n.reduce((n,i)=>{return n[e?e(i):i]=t(i),n},{}),j=n=>n.reduce((n,t)=>n.concat(Array.isArray(t)?j(t):t),[]),O={touched:"touched",untouched:"untouched",valid:"valid",invalid:"invalid",pristine:"pristine",dirty:"dirty"};var w=n=>({bind(t,e,i){a(t,n),t.onfocus=(()=>{u(t,n)}),l(t,e,i,n),t.onblur=function(){const n=f(e,i);n&&n.$validate()}},inserted(t,e,i){l(t,e,i,n)},update(t,e,i){l(t,e,i,n)}}),A={required:"{field} is required.",minlength:"{field} should be at least {minlength} chars.",init(n){if(n)for(const t in n)n.hasOwnProperty(t)&&(this[t]=n[t])},getErrorMessage(n,t,e){let i=this[n];if(!i)return null;if(i=i.replace(new RegExp(/{field}/,"g"),t),e&&e.length)for(let r=0;r<e.length;r++){const n=e[r];i=i.replace(new RegExp(`{${n.name}}`,"g"),n.value)}return i}},V={validate(n){return Array.isArray(n)?!!n.length:void 0!==n&&null!==n&&!!String(n).length},message(n,t){return A.getErrorMessage("required",n,t)}},_={options:[{name:"minlength",value:0}],validate(n,t){const e=parseInt(t.minlength,10);return Array.isArray(n)?0===n.length||n.length>=e:void 0===n||null===n||(""===n||String(n).length>=e)},message(n,t){return A.getErrorMessage("minlength",n,t)}},K={required:V,minlength:_,add(n,t){this[n]||(this[n]=t)}};let L=null;const M={$validate(n){this.setErrors=[],v.call(this,!0),"function"==typeof n&&n()},$reset(){this.setErrors=[],v.call(this,!1)},$setErrors(n){p.call(this,n)}},N={$valid(){return!this.setErrors.length&&!this.dynamicKeys.some(n=>{const t=d(this,n);return c(t)?!t.$valid:!t.$value})},$dirty(){if(this.dirty)return!0;const n=this.dynamicKeys;let t=!1;for(var e=0;e<n.length;e++){const i=n[e],r=this[i],s=c(r);if(t=t||s,s&&r.$dirty)return!0}return t},$error(){return!(!this.$dirty||this.$valid)},$errors(){if(!this.$error)return[];if(this.setErrors.length)return this.setErrors;const n=this.$data.name,t=this.dynamicKeys.map(t=>{const e=this[t];return c(e)?e.$errors:e.$value?null:{field:n,message:e.$message}}).filter(n=>null!==n);return j(t)}},R=Object.keys(M),k=Object.keys(N),q=n=>"v$$"+n,C=(n,t)=>y(t,n);var I={beforeCreate(){const n=Object.assign({},this),e=n.$options.render;"function"==typeof e&&console.log(n);const i=this.$options,r=!!i.validations,s=i.validations;if("undefined"==typeof i.computed&&(i.computed={}),r)i.computed.$v=(()=>C(this,s));else if(i.parent&&i.parent.$v){const n=i._parentVnode.data.directives||[],e=n.filter(n=>"model"===n.name);if(e.length){const n=t(i.parent.$v,e[0].expression);this.$v=n,this.$vChild=!0}}}};let P=function(n,t){P.isInstalled||(t||(t={}),A.init(t.errorMessages),n.directive(t.directiveName||"validity",w(t.inputClasses)),n.mixin(I),P.isInstalled=!0)};"undefined"!=typeof window&&(window.VueValidity=P),P.extend=function(n,t){K.add(n,t)},Object.keys(K).forEach(function(n){P.extend(n,K[n])}),n.validationMixin=I,n.validationDirective=w,n.VueValidity=P,n.default=P,Object.defineProperty(n,"__esModule",{value:!0})});
